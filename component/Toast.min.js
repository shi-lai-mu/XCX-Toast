// 组件作者: 郑余国     https://gitee.com/slm47888/wechat_applet__component_toast
let Task = [], show = null, self = null, hide = null, fn = []; Component({ properties: { data: { type: Object, value: {} } }, data: { error: 'wrong', success: 'chenggong', warning: 'jinggao', loading: 'loading', zhiwen: 'zhiwen', saoma: 'saoma', }, methods: { selectClick: function (e) { let Id = e.target.dataset.fn; fn[Id - 1] && fn[Id - 1]() } }, ready: function () { Object.defineProperty(this.data, 'data', { set: function (data) { let Toast = new Message(data); !show ? Toast.send() : !show.data.hide && show.hide() } }) }, pageLifetimes: { hide: function () { show && (Task = [], show = null, clearTimeout(hide), this.setData({ msg: {} })) }, show: function () { self = this }, } }); function Message(data) { if (typeof data !== 'object') throw Error('data 必须为 Object!'); data.hideTime = (data.hideTime || data.hideTime === false) ? data.hideTime : 1500; if (Task.length) { let t = Task[Task.length - 1]; if (t.text == data.text && t.icon == self.data[data.icon]) return } Task.push({ text: data.text, icon: self.data[data.icon] || "", back: data.icon, hide: data.hideTime, callback: data.callback, select: data.select || false }) } Message.prototype = { data: {}, send: function () { let after = Task[0]; if (after && !show) { for (let key in after['select']) { let val = after['select'][key]; after['select'][key]._fn = val.click ? fn.push(val.click) : false } self.setData({ msg: { _text: after['text'], _type: after['back'], _icon: after['icon'], select: after['select'] } }); after['hide'] && (hide = setTimeout(this.hide, after['hide'])); this.data = after; show = this; Task.shift() } }, hide: function () { show.data.callback && show.data.callback(); show = null; self.setData({ msg: { _text: "", _type: "", _icon: "" } }); setTimeout(Message.check, 400) } }; Message.check = function () { if (Task[0]) !show ? Message.prototype.send() : !show.data.hide && show.hide() }